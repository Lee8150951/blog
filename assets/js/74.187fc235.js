(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{569:function(t,s,a){"use strict";a.r(s);var e=a(7),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"一、xss攻击"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、xss攻击"}},[t._v("#")]),t._v(" 一、XSS攻击")]),t._v(" "),a("p",[a("code",[t._v("xss")]),t._v("全称为"),a("code",[t._v("Cross-Site Scripting")]),t._v("，跨站脚本攻击")]),t._v(" "),a("p",[a("strong",[t._v("本质：注入恶意代码到网站，并使用户加载执行")])]),t._v(" "),a("blockquote",[a("p",[t._v("目的可能有：")]),t._v(" "),a("ul",[a("li",[t._v("获取当前用户在这个网站的"),a("code",[t._v("cookie")]),t._v("，从而得到用户的敏感信息")]),t._v(" "),a("li",[t._v("以当前用户的身份发起一些非用户本意的操作请求，比如删除网站好友，发帖，发私信等等")]),t._v(" "),a("li",[t._v("实现"),a("code",[t._v("DDos")]),t._v("攻击")])])]),t._v(" "),a("p",[t._v("xss攻击分为两种类型：非持久性与持久性")]),t._v(" "),a("h3",{attrs:{id:"_1-1非持久性攻击"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1非持久性攻击"}},[t._v("#")]),t._v(" 1.1非持久性攻击")]),t._v(" "),a("p",[t._v("及时性：恶意代码不需要存在数据库中")]),t._v(" "),a("p",[t._v("例如以下示例：")]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://oreo-image-bed-1310232028.cos.ap-shanghai.myqcloud.com/image/202207161601016.png",alt:"image-20220716160130985"}}),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("query-id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("span")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("查询结果如下"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("span")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" reg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RegExp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"(^|&)q=([^&]*)(&|$)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"i"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" res "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("substr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("decodeURIComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'query-key'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" query\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("代码解析：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("decodeURIComponent()")]),t._v("函数可对"),a("code",[t._v("encodeURIComponent()")]),t._v("函数编码的 URI 进行解码")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" uri"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://www.runoob.com/my test.php?name=ståle&car=saab"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" uri_encode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeURIComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uri_encode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("decodeURIComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uri_encode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n以上实例输出结果"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\nhttps"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("A"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("F"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("Fwww"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("runoob"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("Fmy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("Fname"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("Dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("C3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("A5le"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v("car"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("Dsaab\nhttps"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("runoob"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("my test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ståle"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("car"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("saab\n")])])]),a("ul",[a("li",[a("code",[t._v("window.location.search()")]),t._v("函数可以从问号 (?) 开始的 URL（查询部分）")])]),t._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://oreo-image-bed-1310232028.cos.ap-shanghai.myqcloud.com/image/202207161614388.png",alt:"image-20220716161410361"}}),t._v(" "),a("p",[t._v("现在对该实例进行xss非持久性攻击：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 恶意代码一")]),t._v("\nhttp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("abcd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("q"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 恶意代码二")]),t._v("\nhttp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("abcd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("q"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("img scr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" onerror"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alert(document.cookie)"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("如上所示，恶意代码一将不会成功，因为浏览器已经针对script等一些危险标签的插入做了拦截处理")]),t._v(" "),a("p",[t._v("但是恶意代码二能够成功，因为浏览器无法拦截，成功发起了xss非持久性攻击")]),t._v(" "),a("p",[t._v("这段代码是不用存在数据库中，每次执行都会进行一次攻击")]),t._v(" "),a("h3",{attrs:{id:"_1-2持久性攻击"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2持久性攻击"}},[t._v("#")]),t._v(" 1.2持久性攻击")]),t._v(" "),a("p",[t._v("将恶意代码存入数据库中")]),t._v(" "),a("p",[t._v("例如用户A是一个黑客，在评论区中输入了一段评论，系统将该段评论存入了数据库中")]),t._v(" "),a("img",{staticStyle:{zoom:"33%"},attrs:{src:"https://oreo-image-bed-1310232028.cos.ap-shanghai.myqcloud.com/image/202207161621087.png"}}),t._v(" "),a("p",[t._v("用户B作为一个普通的用户，访问该评论页面时会出现问题")]),t._v(" "),a("img",{staticStyle:{zoom:"33%"},attrs:{src:"https://oreo-image-bed-1310232028.cos.ap-shanghai.myqcloud.com/image/202207161624002.png",alt:"image-20220716162435980"}}),t._v(" "),a("h3",{attrs:{id:"_1-3防御"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3防御"}},[t._v("#")]),t._v(" 1.3防御")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("使用HTML转义。对多由外部插入的代码都进行一次转义，将"),a("code",[t._v("script")]),t._v("标签，"),a("code",[t._v("& < > \"\" '' /")]),t._v("等危险字符都进行过滤和转义替换")])]),t._v(" "),a("li",[a("p",[t._v("尽量避免使用innerHTML、document.write、outerHTML、evel等方法，使用安全性更高的textContent，setAttribute方法")])]),t._v(" "),a("li",[a("p",[t._v("开启"),a("code",[t._v("CSP")]),t._v("保护：在HTTP响应投中设置Content-Security-Policy")])])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("Content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Security"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'self'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不允许内联脚本执行")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 禁止加载外域代码")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 禁止外域提交")]),t._v("\n")])])]),a("h2",{attrs:{id:"二、-csrf攻击"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、-csrf攻击"}},[t._v("#")]),t._v(" 二、 CSRF攻击")]),t._v(" "),a("p",[a("code",[t._v("CSRF")]),t._v("全称为："),a("code",[t._v("Cross-site request forgery")]),t._v("，跨站请求伪造")]),t._v(" "),a("blockquote",[a("p",[t._v("流程：")]),t._v(" "),a("ul",[a("li",[t._v("用户登陆目标网站A")]),t._v(" "),a("li",[t._v("用户以某种方式接触到恶意网站B的链接，比如点击广告等等")]),t._v(" "),a("li",[t._v("用户点击链接访问网站B，网站B中的js代码执行，向目标A发送某个请求")]),t._v(" "),a("li",[t._v("由于用户登陆过A网站，因此该请求携带了网站A的相关cookie凭证，最后请求成功")])])]),t._v(" "),a("h3",{attrs:{id:"_2-1实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1实例"}},[t._v("#")]),t._v(" 2.1实例")]),t._v(" "),a("p",[t._v("例如网站B有以下代码，就会删除用户在A网站的数据")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("A.com/delete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token style-attr"}},[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token style language-css"}},[a("span",{pre:!0,attrs:{class:"token property"}},[t._v("visibility")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("hidden")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("因为img标签中的src是会自动加载的，所以这段代码会自动执行，但是本身这个这个标签由于设置了visibility，图片并不可见")]),t._v(" "),a("h3",{attrs:{id:"_2-2防御"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2防御"}},[t._v("#")]),t._v(" 2.2防御")]),t._v(" "),a("h4",{attrs:{id:"_2-2-1设置cookie的samesite属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1设置cookie的samesite属性"}},[t._v("#")]),t._v(" 2.2.1设置cookie的"),a("strong",[t._v("SameSite")]),t._v("属性")]),t._v(" "),a("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://oreo-image-bed-1310232028.cos.ap-shanghai.myqcloud.com/image/202207161700167.png",alt:"image-20220716170043137"}}),t._v(" "),a("p",[t._v("设置方法："),a("code",[t._v("Set-Cookie: vidget_session=abc123; SameSite=None; Secure")])]),t._v(" "),a("p",[t._v("该属性有三个值：")]),t._v(" "),a("ul",[a("li",[t._v("Strict：跨站点时，任何情况下都不会发送Cookie，只有当前网页的URL与请求目标一样，才会带上Cookie")]),t._v(" "),a("li",[t._v("Lax：大多数情况下不发送第三方Cookie，但是导航到目标网址的Get请求除外，也就是下面这三种方式：")])]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("A.com/delete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("prerender"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("A.com/delete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("form")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("method")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("GET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("action")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("A.com/delete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("ul",[a("li",[t._v("None：SameSite默认设置为Lax，设置none表示关闭了SameSite")])]),t._v(" "),a("h4",{attrs:{id:"_2-2-2-csrf-token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-csrf-token"}},[t._v("#")]),t._v(" 2.2.2 CSRF Token")]),t._v(" "),a("p",[t._v("服务端算法生成token，前端保存在localstorage或者sessionstorage中，之后每次请求都需要带上")]),t._v(" "),a("p",[t._v("由于第三方网站无法获取到该token，因此服务端可以识别出来是不是第三方网站的请求")]),t._v(" "),a("h4",{attrs:{id:"_2-2-3请求源判断"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3请求源判断"}},[t._v("#")]),t._v(" 2.2.3请求源判断")]),t._v(" "),a("p",[t._v("服务端通过请求头中的Referer和Origin字段，判断请求来源")]),t._v(" "),a("h4",{attrs:{id:"_2-2-4二次验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4二次验证"}},[t._v("#")]),t._v(" 2.2.4二次验证")]),t._v(" "),a("p",[t._v("通过手机验证码、邮箱等进行二次验证")]),t._v(" "),a("h2",{attrs:{id:"三、xs-leaks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、xs-leaks"}},[t._v("#")]),t._v(" 三、XS-Leaks")]),t._v(" "),a("p",[a("code",[t._v("XS-Leaks")]),t._v("即跨站泄漏，利用了对HTTP缓存进行查询的机制，通过对资源缓存的判断进而推断出当前用户的相关信息")]),t._v(" "),a("p",[t._v("chrome86版本之前的缓存策略：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("用户访问A页面，请求一张图片资源，浏览器拿到这张图片之后，会将这张图片进行缓存，并把这张图片的URL作为缓存查询的键值")])]),t._v(" "),a("li",[a("p",[t._v("用户接着访问B页面，假如这个页面也用到了上述的那张图片，此时浏览器会先查询是否已经缓存了此资源，由于缓存过这张图片，因此浏览器直接使用了缓存资源")])])]),t._v(" "),a("p",[t._v("由于缓存资源没有域名限制，所有网站都共享了缓存资源")]),t._v(" "),a("p",[t._v("利用这一点就可以检测用户是否访问过特定的网站，恶意网站通过发起特定的资源请求，通过判断此次资源是否来自缓存就可以推断出用户的浏览历史")]),t._v(" "),a("h3",{attrs:{id:"_3-1实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1实例"}},[t._v("#")]),t._v(" 3.1实例")]),t._v(" "),a("p",[t._v('想知道当前访问我们网站的用户是否是A网站昵称为"小a"的用户，可以这么做:')]),t._v(" "),a("ul",[a("li",[a("p",[t._v("在A网站，将小a的用户头像扒下来，假设地址为"),a("code",[t._v("http://A.com/user/helloWorld.jpg")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("FETCH POST http://A.com/user/helloWorld.jpg")]),t._v("，清除测览器缓存的这张图")])]),t._v(" "),a("li",[a("p",[a("code",[t._v('<link ref=rerender href=" http://A.com/user"/>')]),t._v("，强制刷新A网站")])]),t._v(" "),a("li",[a("p",[t._v("请求头像地址，判断其是否来自缓存")])]),t._v(" "),a("li",[a("p",[t._v("如果来自该缓存，则说明该用户就是“小a”")])])]),t._v(" "),a("h3",{attrs:{id:"_3-2防御"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2防御"}},[t._v("#")]),t._v(" 3.2防御")]),t._v(" "),a("ul",[a("li",[t._v("Cookie设置SameSite，可能能够拦截最后一步：获取资源并判断是否来源于缓存")]),t._v(" "),a("li",[t._v("CSRF Token")]),t._v(" "),a("li",[t._v("浏览器支持对缓存资源的分域名管理，让第三方网站无法读取A网站的缓存")])]),t._v(" "),a("h2",{attrs:{id:"四、真题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、真题"}},[t._v("#")]),t._v(" 四、真题")]),t._v(" "),a("h3",{attrs:{id:"_4-1百度2020校招web前端工程师"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1百度2020校招web前端工程师"}},[t._v("#")]),t._v(" 4.1百度2020校招Web前端工程师")]),t._v(" "),a("blockquote",[a("ul",[a("li",[a("p",[t._v("题目：由于前端直接可被用户访问，攻击者可以轻易得到页面和通讯过程中的相关信息，进而进行恶意的攻击，关于其攻击的方式描述正确的有哪些")])]),t._v(" "),a("li",[a("p",[t._v("选项：")]),t._v(" "),a("ul",[a("li",[t._v("假定站点 foo.com 的服务器架设在公司内网，提供了任意站点截图服务 foo.com/screenshot?url=xxx，恶意修改 url 中的值为内网地址，构成 SSRF 攻击，进而造成数据泄露的风险")]),t._v(" "),a("li",[t._v("网站 foo.com 提供 POST 方法的 /tansfer/to/xxx 的转账服务，由于未做 CSRF 的防范，被攻击者重复伪造该请求，形成重放攻击，造成经济损失")]),t._v(" "),a("li",[t._v("网站 foo.com 使用了非安全的 HTTP 协议，其中转账服务 POST /transfer/to/xxx，转账金额 money 在 payload 上，假定接口层面采用了随机 token 来防范 csrf 攻击，接口参数未做签名校验，此时攻击者通过篡改 money 的数值，构成中间人攻击")]),t._v(" "),a("li",[t._v("借助社会工程学的理论基础，基于用户的贪婪等心理，制作一个 qq.com 的”冒牌”中奖页面，诱导用户输入账号密码进行登录，造成隐私的泄露，属于”钓鱼”的网络欺诈行为")])])]),t._v(" "),a("li",[a("p",[t._v("答案：ABCD")])])])]),t._v(" "),a("p",[a("strong",[t._v("SSRF概念")]),t._v("：SSRF为服务端请求伪造(Server-Side Request Forgery)，指的是攻击者在未能取得服务器所有权限时利用服务器漏洞以服务器的身份发送一条构造好的请求给服务器所在内网")]),t._v(" "),a("p",[t._v("SSRF攻击通常针对外部网络无法直接访问的内部系统")]),t._v(" "),a("p",[a("strong",[t._v("原理")])]),t._v(" "),a("p",[t._v("很多web应用都提供了从其他的服务器上获取数据的功能。使用指定的URL，web应用便可以获取图片，下载文件，读取文件内容等。SSRF的实质是利用存在缺陷的web应用作为代理攻击远程和本地的服务器。一般情况下， SSRF攻击的目标是外网无法访问的内部系统，黑客可以利用SSRF漏洞获取内部系统的一些信息（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）")]),t._v(" "),a("p",[t._v("SSRF形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制")]),t._v(" "),a("p",[a("strong",[t._v("攻击方式")])]),t._v(" "),a("p",[t._v("攻击者想要访问主机B上的服务，但是由于存在***或者主机B是属于内网主机等原因导致攻击者无法直接访问主机B。而服务器A存在SSRF漏洞，这时攻击者可以借助服务器A来发起SSRF攻击，通过服务器A向主机B发起请求，从而获取主机B的一些信息")])])}),[],!1,null,null,null);s.default=n.exports}}]);